# garnix actions

This repo includes some garnix actions that are generally useful, as well as
helpers from writing your own actions.

## Actions

### reviewDog

```
reviewDog : { linter, errorFormat, encryptedTokenFile } -> App
```

Generic function for sending linting and other automated
feedback to GitHub pull requests. Can be combined with a wide
range of linters.

- linter: A command that generates lints.
- errorFormat: What format the linter outputs. See [here](https://github.com/reviewdog/reviewdog?tab=readme-ov-file#errorformat) for more details.
- encryptedTokenFile: The path to an encrypted GitHub Personal Access Token. Can be generated by running the `.setupSecrets` attribute of the resulting app.
- actionName: The name of the action. Must match the key in `outputs` to which this action is assigned (`apps.x86_64-linux.<name>`).

Example:

```nix
{

  outputs = { ... }:
    apps.x86_64-linux.statix = actions.lib.reviewDog
      { actionName = "statix";
        linter = "${pkgs.statix}/bin/statix check . -o errfmt";
        errorFormat = "%f>%l:%c:%.%#:%.%#:%m";
        encryptedTokenFile = ./secrets/reviewDogToken;
      }
}
```

### statix

```
statix : { disabled ? [], ignore ? [] } -> App
```

Run [statix](https://github.com/oppiliappan/statix) on your Nix files.

- actionName: The name of the output this action is running as.
- disabled: A list of lints to disable. See [here](https://github.com/oppiliappan/statix?tab=readme-ov-file#configuration) for more details. Default: [].
- ignore: A list of paths (globs allowed) to not check. Default: [].

Example:

```nix
{

  outputs = { ... }:
    apps.x86_64-linux.statix = actions.lib.statix
      { actionName = "statix";
        disabled = [ "useless_parens" ];
      }
}
```

## Helpers

### getGitHubPAT

```
getGitHubPAT : { appName, appDescription, actionName } -> Executable
```

getGitHubPAT is a helper that gets and encrypts a GitHub Personal Access Token.


